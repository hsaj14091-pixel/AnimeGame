<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª | Lobby</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --bg: #121212; --card: #1e1e2e; --accent: #f39c12; --otaku: #8e44ad; --text: #fff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .title { font-size: 1.8rem; color: var(--otaku); font-weight: bold; }
        
        .btn-create { background: var(--accent); color: #000; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-create:hover { background: #e67e22; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºØ±Ù */
        .rooms-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .room-card { 
            background: var(--card); padding: 20px; border-radius: 15px; 
            border: 1px solid #333; position: relative; transition: 0.3s;
        }
        .room-card:hover { transform: translateY(-5px); border-color: var(--otaku); }
        
        .room-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .room-name { font-size: 1.2rem; font-weight: bold; }
        .lock-icon { color: #e74c3c; }
        
        .room-info { color: #aaa; font-size: 0.9rem; margin-bottom: 15px; }
        .join-btn { width: 100%; padding: 10px; background: #2c3e50; border: none; color: white; border-radius: 8px; cursor: pointer; }
        .join-btn:hover { background: var(--otaku); }

        /* Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© (Modal) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: var(--card); padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; }
        .input-field { width: 100%; padding: 12px; margin: 10px 0; background: #121212; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; }
        
    </style>
</head>
<body>

    <div class="header">
        <div class="title">âš”ï¸ ØµØ§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</div>
        <button class="btn-create" onclick="openCreateModal()">+ Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯</button>
    </div>

    <div id="rooms-container" class="rooms-grid">
        <p style="color:#777; width:100%">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØºØ±Ù...</p>
    </div>

    <div id="create-modal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠ</h3>
            <input type="text" id="new-room-name" class="input-field" placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ© (Ù…Ø«Ø§Ù„: Ù‚Ø±Ø§ØµÙ†Ø© Ù‚Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø´)">
            <input type="text" id="new-room-pass" class="input-field" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <br><br>
            <button class="btn-create" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡</button>
            <button class="join-btn" onclick="closeModal()" style="margin-top:10px; background:transparent">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();
        const username = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙŠØ§ Ø¨Ø·Ù„:", "Otaku Player") || "Ù…Ø¬Ù‡ÙˆÙ„";
        sessionStorage.setItem('username', username);

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºØ±Ù
        socket.on('update_room_list', (rooms) => {
            const container = document.getElementById('rooms-container');
            container.innerHTML = '';
            
            if(rooms.length === 0) {
                container.innerHTML = '<p style="color:#777">Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙƒÙ† Ø§Ù„Ø£ÙˆÙ„ ÙˆØ£Ù†Ø´Ø¦ ØºØ±ÙØ©!</p>';
                return;
            }

            rooms.forEach(room => {
                const isLocked = room.isPrivate ? '<span class="lock-icon">ğŸ”’ Ø®Ø§Øµ</span>' : '<span style="color:#2ecc71">ğŸ”“ Ø¹Ø§Ù…</span>';
                
                container.innerHTML += `
                    <div class="room-card">
                        <div class="room-header">
                            <span class="room-name">${room.name}</span>
                            ${isLocked}
                        </div>
                        <div class="room-info">
                            Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: ${room.count}/2
                        </div>
                        <button class="join-btn" onclick="attemptJoin('${room.id}', ${room.isPrivate})">Ø¯Ø®ÙˆÙ„</button>
                    </div>
                `;
            });
        });

        // Ø¯ÙˆØ§Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©
        function openCreateModal() { document.getElementById('create-modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('create-modal').style.display = 'none'; }
        
        function createRoom() {
            const name = document.getElementById('new-room-name').value;
            const pass = document.getElementById('new-room-pass').value;
            if(!name) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù…Ø§Ù‹ Ù„Ù„ØºØ±ÙØ©!");
            
            socket.emit('create_room', { username: username, room_name: name, password: pass });
        }

        socket.on('room_created_success', (data) => {
            sessionStorage.setItem('isHost', data.isHost); // Ù†Ø®Ø²Ù† Ø£Ù†Ù‡ Ù‡Ùˆ Ø§Ù„Ù…Ø¶ÙŠÙ
            window.location.href = `/multiplayer_room/${data.roomId}`;
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        function attemptJoin(roomId, isPrivate) {
            let password = '';
            if(isPrivate) {
                password = prompt("Ù‡Ø°Ù‡ Ø§Ù„ØºØ±ÙØ© Ø®Ø§ØµØ©ØŒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
                if(password === null) return;
            }
            socket.emit('join_request', { roomId: roomId, password: password, username: username });
        }

        socket.on('join_success', (data) => {
            sessionStorage.setItem('isHost', false); // Ù‡Ø°Ø§ Ù„Ø§Ø¹Ø¨ Ø¶ÙŠÙ
            window.location.href = `/multiplayer_room/${data.roomId}`;
        });

        socket.on('error_msg', (msg) => { alert("Ø®Ø·Ø£: " + msg); });
    </script>
</body>
</html>